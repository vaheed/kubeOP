# Security

## RBAC and service accounts

- The operator runs as the `kubeop-operator` service account defined in [`deploy/k8s/operator/rbac.yaml`](https://github.com/vaheed/kubeOP/blob/main/deploy/k8s/operator/rbac.yaml#L1-L36). The ClusterRole grants CRUD on kubeOP CRDs, Kubernetes namespaces, LimitRanges, ResourceQuotas, NetworkPolicies, ConfigMaps, Secrets, and Events.
- The Helm chart ships the same RBAC objects under [`charts/kubeop-operator/templates`](https://github.com/vaheed/kubeOP/tree/main/charts/kubeop-operator/templates).
- Project namespaces inherit additional isolation from the NetworkPolicy enforced in the reconciler (`ensureEgressPolicy`), restricting egress unless policies are edited.

## Manager authentication

- JWT-based auth is controlled via `KUBEOP_REQUIRE_AUTH` in [`internal/config.Parse`](https://github.com/vaheed/kubeOP/blob/main/internal/config/config.go#L18-L52). When enabled, tokens must be signed with `KUBEOP_JWT_SIGNING_KEY` (base64 HMAC key) and claims checked by helpers in [`internal/api/server.go`](https://github.com/vaheed/kubeOP/blob/main/internal/api/server.go#L91-L165).
- The manager refuses to start without a decoded JWT key or KMS key unless `KUBEOP_DEV_INSECURE=true` (`Config.Validate`).

## Secrets and webhooks

- Webhook deliveries use an HMAC signature header `X-KubeOP-Signature` generated by [`webhook.Client.Send`](https://github.com/vaheed/kubeOP/blob/main/internal/webhook/webhook.go#L18-L45). Configure `KUBEOP_HOOK_SECRET` to sign payloads; leave it empty to disable the webhook entirely.
- Registry credentials for apps should be stored in Kubernetes secrets referenced by `spec.passwordRef` on the `Registry` CRD; the operator does not read the secret today, but validations ensure the reference exists when a username is supplied (`paas.kubeop.io_registries.yaml`).

## Network

- The operator deployment exposes metrics on port 8081 and health probes on 8082; restrict these endpoints using the chart-provided NetworkPolicy (`charts/kubeop-operator/templates/networkpolicy.yaml`).
- The manager HTTP server listens on `KUBEOP_HTTP_ADDR` (default `:8080`). Use cluster ingress or service mesh policies to limit access to `/v1/jwt/project` and `/v1/kubeconfigs/...` endpoints.

## Supply chain

- Images are built from [`deploy/Dockerfile.operator`](https://github.com/vaheed/kubeOP/blob/main/deploy/Dockerfile.operator) and [`deploy/Dockerfile.manager`](https://github.com/vaheed/kubeOP/blob/main/deploy/Dockerfile.manager). Build args inject the semantic version and Git commit (`Makefile` `image-*` targets).
- The `VERSION` file controls the semantic version embedded in binaries via linker flags (`Makefile` `LDFLAGS`).
