# -----------------------------------------------------------------------------
# kubeOP environment defaults (.env.example)
# Copy this file to `.env` and adjust values for your deployment.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Database configuration
# -----------------------------------------------------------------------------
# PostgreSQL connection string used by the manager API and integration tests.
# Format: postgres://USER:PASS@HOST:PORT/DB?sslmode=disable
# Local default leverages the bundled postgres service from docker-compose.
KUBEOP_DB_URL=postgres://kubeop:kubeop@localhost:5432/kubeop?sslmode=disable

# Compose-only variables for the bundled Postgres service
POSTGRES_USER=kubeop
POSTGRES_PASSWORD=kubeop
POSTGRES_DB=kubeop
POSTGRES_PORT=5432
POSTGRES_TAG=16-alpine

# -----------------------------------------------------------------------------
# Authentication & encryption
# -----------------------------------------------------------------------------
# Require JWT authentication on every API request. Set to `true` for production.
KUBEOP_REQUIRE_AUTH=true

# Base64-encoded HS256 signing key used to validate incoming API tokens.
# Generate a 32-byte key: `openssl rand -base64 32`
KUBEOP_JWT_SIGNING_KEY=replace-with-base64-jwt-key

# Base64-encoded 32-byte envelope encryption key for secrets at rest.
# Generate: `openssl rand -base64 32`
KUBEOP_KMS_MASTER_KEY=replace-with-base64-kms-key

# Listen address for the manager API HTTP server (default `:8080`).
KUBEOP_HTTP_ADDR=:8080
KUBEOP_MANAGER_PORT=18080

# -----------------------------------------------------------------------------
# Image policy safeguards enforced by the admission service
# -----------------------------------------------------------------------------
# Comma-separated list of registry hosts allowed in App specifications (image
# allow list). Only these registries can appear at the start of image
# references in App specs. Use plain hosts without schemes. Example:
KUBEOP_IMAGE_ALLOWLIST=docker.io,ghcr.io,quay.io

# Comma-separated list of destination CIDRs allowed for egress from project
# namespaces (baseline). The admission webhook denies NetworkPolicies that
# attempt to allow egress IPBlocks outside this baseline, effectively denying
# internet access except to the approved ranges. Clusterâ€‘internal traffic via
# podSelector/namespaceSelector is permitted. Example (RFC1918 only):
KUBEOP_EGRESS_BASELINE=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# Strict ResourceQuota validation. When set, admission denies ResourceQuota
# objects that omit requests.cpu or requests.memory, or that exceed these
# maxima. Leave unset to disable the ceiling checks.
# Examples:
#   KUBEOP_QUOTA_MAX_REQUESTS_CPU=4        # 4 cores total for Requests
#   KUBEOP_QUOTA_MAX_REQUESTS_MEMORY=8Gi   # 8 GiB total for Requests
KUBEOP_QUOTA_MAX_REQUESTS_CPU=
KUBEOP_QUOTA_MAX_REQUESTS_MEMORY=

# -----------------------------------------------------------------------------
# Operator bootstrap overrides consumed by the manager
# -----------------------------------------------------------------------------
# Override the image (including tag) used when bootstrapping the kubeOP operator.
# Defaults to the release image published to GHCR.
KUBEOP_OPERATOR_IMAGE=ghcr.io/vaheed/kubeop/operator:latest

# Override the pull policy applied to the operator Deployment during bootstrap.
# Valid options: Always, IfNotPresent, Never
KUBEOP_OPERATOR_IMAGE_PULL_POLICY=Always

# Automatically bootstrap the operator when the manager starts.
# The manager applies CRDs from KUBEOP_BOOTSTRAP_CRDS_DIR and operator manifests
# from KUBEOP_BOOTSTRAP_OPERATOR_DIR to the cluster pointed to by $KUBECONFIG
# (or in-cluster config if running inside Kubernetes). Ensure those paths are
# available to the manager container (mount them or build them in) when enabled.
KUBEOP_BOOTSTRAP_ON_START=false
KUBEOP_BOOTSTRAP_CRDS_DIR=deploy/k8s/crds
KUBEOP_BOOTSTRAP_OPERATOR_DIR=deploy/k8s/operator

# -----------------------------------------------------------------------------
# Observability & diagnostics
# -----------------------------------------------------------------------------
# Enable verbose logging (debug|info|warn). Leave unset to use the binary default.
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Billing rates (per-hour unit costs)
# -----------------------------------------------------------------------------
# Optional rates used by invoice aggregation; defaults are minimal if unset.
# Cost per CPU milli-hour and per MiB-hour.
KUBEOP_RATE_CPU_MILLI=0.000001
KUBEOP_RATE_MEM_MIB=0.0000002
